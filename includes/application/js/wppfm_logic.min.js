/*!
 * logic.js v1.2
 * Part of the WP Product Feed Manager
 * Copyright 2016, Michel Jongbloed
 *
 */
"use strict";var $jq=jQuery.noConflict();var _feedHolder;function wppfm_editCategories(){if(!wppfm_isCustomChannel(_feedHolder.channel)){var b=_feedHolder.mainCategory.split(" > ");$jq("#selected-categories").hide();$jq("#lvl_0").prop("disabled",false);for(var a=0;a<b.length;a++){$jq("#lvl_"+a).show()}}else{$jq("#category-selector-lvl").html(wppfm_freeCategoryInputCntrl("default",_feedHolder.feedId,_feedHolder.mainCategory));$jq("#category-selector-lvl").prop("disabled",false)}}function wppfm_generateFeed(){if($jq("#file-name").val()!==""){if(_feedHolder.categoryMapping&&_feedHolder.categoryMapping.length>0){wppfm_generateAndSaveFeed()}else{var a=confirm("You've not selected a Shop Category in the Category Mapping Table. With no Shop Category selected, your feed will be empty.\n\n Are you sure you still want to save this feed?");if(a===true){wppfm_generateAndSaveFeed()}}}else{jQuery("#alert-message").html("<p>A file name is required!</p>");jQuery("#success-message").show()}}function wppfm_saveFeedData(){if($jq("#file-name").val()!==""){wppfm_saveFeed()}else{jQuery("#alert-message").html("<p>A file name is required!</p>");jQuery("#success-message").show()}}function getCombinedValue(g,f){var h=1;var b="";var d=_feedHolder.getCombinedOutputValue(g,f);while($jq("#combined-input-field-cntrl-"+g+"-"+f+"-"+h).val()){var a=g+"-"+f+"-"+h;var e=$jq("#combined-input-field-cntrl-"+a).val();b+=h>1?$jq("#combined-separator-cntrl-"+a).val()+"#":"";if(e!=="static"){b+=e!=="select"?e+"|":""}else{if($jq("#static-input-field-"+a).val()){b+=e+"#"+$jq("#static-input-field-"+a).val()+"|"}else{b=d+"|";break}}h++}b=b.substring(0,b.length-1);return h>1?b:false}function wppfm_staticValueChanged(c,b,a){if(a>0){wppfm_changedCombinedOutput(c,b,a)}else{wppfm_setStaticValue(c,b,a);if(c===34){wppfm_setIdentifierExistsDependancies()}}}function wppfm_changedOutputSelection(a){if($jq("#output-field-cntrl-"+a).val()!=="no-value"){wppfm_activateOptionalFieldRow(a,$jq("#output-field-cntrl-"+a).val())}}function wppfm_hasExtraSourceRow(a,b){if(b.length>0){return b[a-1].hasOwnProperty("c")?true:false}else{return false}}function wppfm_changedCustomOutputTitle(){var a=$jq("#custom-output-title-input").val();if(a){wppfm_activateCustomFieldRow(a)}}function wppfm_deleteSpecificFeed(c,b){var a=confirm("Please confirm you want to delete feed "+b+".");if(a===true){wppfm_deleteFeed(c,b);console.log("File "+b+" removed from server.")}}function wppfm_alertRemoveChannel(){var a=confirm("Please confirm you want to remove this channel! Removing this channel will also remove all its feed files.");if(a!==true){return false}}function wppfm_valueOptionChanged(d,c,e){var b=$jq("#value-options-"+d+"-"+c+"-"+e).val();var a=wppfm_getCorrectValueSelector(d,c,0,b,"","");$jq("#value-editor-input-span-"+d+"-"+c+"-"+e).html(a)}function wppfm_getCorrectValueSelector(f,e,g,c,d,a){var b="";switch(c){case"0":case"change nothing":wppfm_valueInputOptionsChanged(f,e,g);b="";break;case"1":case"overwrite":b=wppfm_valueOptionsSingleInput(f,e,g,d);break;case"2":case"replace":b=wppfm_valueOptionsReplaceInput(f,e,g,d,a);break;case"3":case"remove":case"4":case"add prefix":case"5":case"add suffix":b=wppfm_valueOptionsSingleInputValue(f,e,g,d);break;case"6":case"recalculate":b=wppfm_valueOptionsRecalculate(f,e,g,d,a);break;case"7":case"convert to child-element":b=wppfm_valueOptionsElementInput(f,e,g,d);break;default:b=wppfm_valueOptionsSingleInput(f,e,g,d);break}return b}function wppfm_deactivateFeed(a){wppfm_switchFeedStatus(a,function(b){if(b==="1"){wppfm_updateFeedRowStatus(a,1)}else{wppfm_updateFeedRowStatus(a,2)}})}function wppfm_duplicateFeed(b,a){wppfm_duplicateExistingFeed(b,function(c){if(c){wppfm_show_success_message('Added a copy of feed "'+a+'" to the list.')}})}function wppfm_viewFeed(a){window.open(a)}function wppfm_addRowValueEditor(c,b,d,a){$jq("#end-row-id-"+c).remove();$jq("#row-"+c).append(wppfm_valueEditor(c,b,d,a)+wppfm_endrow(c));$jq("#value-editor-input-query-add-span-"+c+"-"+b+"-"+d).remove()}function wppfm_getFeedObject(a,b){wppfm_getFeedData(a,function(c){if(c!=="0"){var e=JSON.parse(c)[0];var d=new Feed(e.product_feed_id,e.title,e.include_variations,e.is_aggregator,String(e.channel),e.main_category,e.category_mapping,e.url,e.source,e.country,e.feed_title,e.feed_description,e.schedule,"",e.status_id);b(d)}else{b(0)}})}function wppfm_addValueEditorQuery(c,b,a){if(wppfm_change_value_is_filled(c,b,a)){if(wppfm_query_is_filled(c,(b-1),1)){wppfm_showEditValueQuery(c,b,a,true)}else{alert("Add at least one query in the previous change value row before adding a new row.")}}else{alert("Please first fill in a change value option before adding a query to it.")}}function wppfm_queryStringToQueryObject(c){var b={};if(c){for(var a in c){b=wppfm_convertQueryStringToQueryObject(c[a])}}return b}function wppfm_valueStringToValueObject(b){var a={};if(b){for(var c in b){if(c!=="q"){a=wppfm_convertValueStringToValueObject(b[c])}}}return a}function wppfm_convertQueryStringToQueryObject(c){var b={};var a=c.split("#");if(a[0]==="1"||a[0]==="2"){b.preCondition=a[0]}else{b.preCondition="0"}b.source=a[1];b.condition=a[2];b.value=a[3]?a[3]:"";b.endValue=a[5]?a[5]:"";return b}function wppfm_resortObject(b){var a=[];var e=1;for(var d in b){var f={};for(var c in b[d]){if(c!=="q"){f[e]=b[d][c];a.push(f)}else{a[e-1].q=b[d][c]}}e++}return e>1?a:""}function wppfm_convertValueStringToValueObject(b){var a={};var c=b.split("#");a.preCondition=c[0];a.condition=c[1];a.value=c[2];a.endValue=c[3]?c[3]:"";return a}function wppfm_makeCleanQueryObject(){var a={};a.preCondition="if";a.source="select";a.condition="";a.value="";a.endValue="";return a}function wppfm_makeCleanValueObject(){var a={};a.preCondition="change";a.condition="overwrite";a.value="";a.endValue="";return a}function wppfm_addNewItemToCategoryString(h,a,f,e){var b=a.split(e).length;if(h==="0"){return f}else{if(b<=h){return a+e+f}else{var g=0;for(var c=0;c<h;c++){g=a.indexOf(e,g+1);var d=a.substring(0,g);return d+e+f}}}};