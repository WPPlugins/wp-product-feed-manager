/*!
 * metadatahandling.js v1.1
 * Part of the WP Product Feed Manager
 * Copyright 2017, Michel Jongbloed
 *
 */
"use strict";var $jq=jQuery.noConflict();function wppfm_storeSourceValue(a,b,g,c){console.log("level:",a);console.log("currentMetaValue:",b);console.log("type:",g);console.log("valueToStore:",c);var d="";var e=b?JSON.parse(b):{};if(e&&"t" in e){return b}if(c&&g!=="clear"){var h={},i={};i[g]=c;h.s=i;if(e.hasOwnProperty("m")){if(!e.m[a]){e.m[a]=h}else{e.m[a].s=i}}else{var f=[];f.push(h);e.m=f}}else{if(g==="clear"){if(e.hasOwnProperty("m")){if(e.m.length>1){if(!e.m[a].c){e.m.splice(a,1)}else{delete e.m[a].s}}else{delete e.m}}else{e={}}}}d=typeof(e)&&!$jq.isEmptyObject(e)?JSON.stringify(e):"";console.log("result:",d);return d}function wppfm_storeConditionValue(b,l,d,g){console.log("sourceLevel:",b);console.log("conditionLevel:",l);console.log("currentMetaValue:",d);console.log("newCondition:",g);var e="";var f=d?JSON.parse(d):{};var j=l-1;var k={};var a={};if(g){if(!f.hasOwnProperty("m")){var h=[];h.push(k);f.m=h}if(f.m[b]&&f.m[b].hasOwnProperty("c")){a[l]=g;if(f.m[b].c.hasOwnProperty(j)){f.m[b].c[j]=a}else{f.m[b].c.push(a)}}else{var i=[];a[l]=g;i.push(a);k.c=i;f.m[b].c=i}}e=typeof(f)&&!$jq.isEmptyObject(f)?JSON.stringify(f):"";console.log("result:",e);return e}function wppfm_storeCombinedValue(f,c,b){console.log("sourceLevel:",f);console.log("currentMetaValue:",c);console.log("valueToStore:",b);var g="";var h=c?JSON.parse(c):{};if(b){var a=[],d={},e={};if(!h.hasOwnProperty("m")){a.push(d);h.m=a}if(!h.m[f].hasOwnProperty("s")){e.source="combined";h.m[f].s=e}h.m[f].s.f=b}g=typeof(h)&&!$jq.isEmptyObject(h)?JSON.stringify(h):"";console.log("result:",g);return g}function wppfm_storeValueChange(a,g,b,f,c){console.log("sourceLevel:",a);console.log("valueEditorLevel:",g);console.log("valueToStore:",b);console.log("action:",f);console.log("currentMetaValue:",c);var d="";var e=c?JSON.parse(c):{};var i={};if(b&&f==="add"){i[a+1]=b;if(e.hasOwnProperty("v")){if(e.v[a]&&e.v[a].hasOwnProperty("q")){e.v[a][g+1]=b}else{e.v[a]=i}}else{var h=[];h.push(i);e.v=h}}else{if(f==="clear"){if("v" in e){if(e.v.length>1){if(!e.v[a].q){e.v.splice(a,1)}else{delete e.v[a].s}}else{delete e.v}}else{e={}}}}d=typeof(e)&&!$jq.isEmptyObject(e)?JSON.stringify(e):"";console.log("result:",d);return d}function wppfm_removeCombinedValue(d,c,a){console.log("sourceLevel:",d);console.log("combinedLevel:",c);console.log("currentMetaValue:",a);var e="";var f=a?JSON.parse(a):{};if(f.hasOwnProperty("m")&&f.m[d].hasOwnProperty("s")&&f.m[d].s.hasOwnProperty("f")){if(f.m[d].s.f){var b=f.m[d].s.f.split("|");b.splice(c-1,1);f.m[d].s.f=wppfm_makeCombinedValuesStringFromArray(b)}}e=typeof(f)&&!$jq.isEmptyObject(f)?JSON.stringify(f):"";console.log("result:",e);return e}function wppfm_removeConditionValue(d,b,a){console.log("sourceLevel:",d);console.log("conditionLevel:",b);console.log("currentMetaValue:",a);var e="";var f=a?JSON.parse(a):{};if(f&&f.hasOwnProperty("m")&&f.m[d]&&f.m[d].hasOwnProperty("c")){if(f.m[d].c[b]){if(f.m[d].c.length>1){f.m[d].c.splice(b,1);f.m[d].c=wppfm_resortObject(f.m[d].c)}else{var c=wppfm_countObjectItems(f.m);if(c>2){f.m.splice([d],1)}else{if(c<1){if(f.hasOwnProperty("v")){delete f.m[d]}else{f={}}}else{if(f.m[d].hasOwnProperty("s")){delete f.m[d].c;f.m.splice([d+1],1)}else{if(f.hasOwnProperty("v")){delete f.m[d]}else{f={}}}}}}}}else{if(f&&f.hasOwnProperty("m")&&f.m[d]&&f.m[d].hasOwnProperty("s")){var c=wppfm_countObjectItems(f.m);if(c>1){f.m.splice([d],1)}else{if(f.hasOwnProperty("v")){delete f.m[d]}else{f={}}}}}e=typeof(f)&&!$jq.isEmptyObject(f)?JSON.stringify(f):"";console.log("result:",e);return e}function wppfm_removeQueryValue(d,b,a){console.log("sourceLevel:",d);console.log("conditionLevel:",b);console.log("currentMetaValue:",a);var e="";var f=a?JSON.parse(a):{};if(f&&f.hasOwnProperty("v")&&f.v[d]&&f.v[d].hasOwnProperty("q")){if(f.v[d].q[b-1]){if(f.v[d].q.length>1){f.v[d].q.splice((b-1),1);f.v[d].q=wppfm_resortObject(f.v[d].q)}else{var c=wppfm_countObjectItems(f.v);if(c>2){f.v.splice([d],1)}else{if(c<1){if(f.hasOwnProperty("m")){delete f.v[d]}else{f={}}}else{if(f.v[d].hasOwnProperty("1")){delete f.v[d].q}else{if(f.hasOwnProperty("m")){delete f.v[d]}else{f={}}}}}}}}e=typeof(f)&&!$jq.isEmptyObject(f)?JSON.stringify(f):"";console.log("result:",e);return e}function wppfm_removeEditValuesValue(b,e,a){console.log("sourceLevel:",b);console.log("valueEditorLevel:",e);console.log("currentMetaValue:",a);var c="";var d=a?JSON.parse(a):{};var c="";var d=a?JSON.parse(a):{};if("v" in d){if(d.v.length>1){d.v.splice(b,1)}else{delete d.v}}else{d={}}c=typeof(d)&&!$jq.isEmptyObject(d)?JSON.stringify(d):"";console.log("result:",c);return c}function wppfm_storeQueryValue(c,g,d,k){console.log("sourceLevel:",c);console.log("queryLevel:",g);console.log("currentMetaValue:",d);console.log("newQuery:",k);var e="";var f=d?JSON.parse(d):{};var h=g-1;var j={};var a={};if(k){if(!f.hasOwnProperty("v")){var i=[];i.push(j);f.v=i}if(f.v[c]&&f.v[c].hasOwnProperty("q")){a[g]=k;if(f.v[c].q.hasOwnProperty(h)){f.v[c].q[h]=a}else{f.v[c].q.push(a)}}else{var b=[];a[g]=k;b.push(a);j.q=b;f.v[c].q=b}}e=typeof(f)&&!$jq.isEmptyObject(f)?JSON.stringify(f):"";console.log("result:",e);return e}function wppfm_makeCombinedValuesStringFromArray(b){var a="";for(var c=0;c<b.length;c++){a+=b[c];a+=c<(b.length-1)?"|":""}return a}function changeFeedFilterValue(g,c,f){console.log("workValue:",g);console.log("newValues:",c);console.log("changedFilterLevel:",f);if(g){var e=JSON.parse(g[0]["meta_value"])}else{var e=[];g=[];var a={meta_value:""};g.push(a)}var d=e.length;var b=c[0]+"#"+c[1]+"#"+c[2];b+=c[2]!=="4"&&c[2]!=="5"?"#"+c[3]:"";if(f<=d){e[f-1][f]=b}else{var h={};h[f]=b;e[f-1]=h}g[0]["meta_value"]=JSON.stringify(e);console.log("result:",JSON.stringify(g));return g}function removeFeedFilterLevel(f,g){console.log("workValue:",f);console.log("levelToRemove:",g);var e=f?JSON.parse(f[0]["meta_value"]):{};var d=[];var c=0;for(var b in e){if(parseInt(b)!==g-1){var a={};a[c+1]=e[b][parseInt(b)+1];d[c]=a;c++}}if(d.length>0){f[0]["meta_value"]=JSON.stringify(d);console.log("result:",JSON.stringify(f))}else{f="";console.log("result:",f)}return f};