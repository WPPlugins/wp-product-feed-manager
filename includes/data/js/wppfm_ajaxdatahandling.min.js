/*!
 * ajaxdatahandling.js v2.1
 * Part of the WP Product Feed Manager
 * Copyright 2017, Michel Jongbloed
 *
 */
"use strict";var MyAjax;function wppfm_getFeedList(a){jQuery.post(MyAjax.ajaxurl,{action:"myajax-get-list-of-feeds",postFeedsListNonce:MyAjax.postFeedsListNonce},function(b){a(wppfm_validateResponse(b))})}function wppfm_getBackupsList(a){jQuery.post(MyAjax.ajaxurl,{action:"myajax-get-list-of-backups",postBackupListNonce:MyAjax.postBackupListNonce},function(b){a(wppfm_validateResponse(b))})}function wppfm_getSettingsOptions(a){jQuery.post(MyAjax.ajaxurl,{action:"myajax-get-settings-options",postSetupOptionsNonce:MyAjax.postSetupOptionsNonce},function(b){a(wppfm_validateResponse(b))})}function wppfm_getOutputFields(a,b,c){jQuery.post(MyAjax.ajaxurl,{action:"myajax-get-output-fields",feedId:a,channelId:b,outputFieldsNonce:MyAjax.outputFieldsNonce},function(d){c(wppfm_validateResponse(d))})}function wppfm_getSourceFields(a,b){jQuery.post(MyAjax.ajaxurl,{action:"myajax-get-input-fields",sourceId:a,inputFieldsNonce:MyAjax.inputFieldsNonce},function(c){b(wppfm_validateResponse(c))})}function wppfm_getMainFeedFilters(a,b){jQuery.post(MyAjax.ajaxurl,{action:"myajax-get-main-feed-filters",feedId:a,inputFeedFiltersNonce:MyAjax.inputFeedFiltersNonce},function(c){b(wppfm_validateResponse(c))})}function wppfm_getNextCategories(c,b,a,e,d){jQuery.post(MyAjax.ajaxurl,{action:"myajax-get-next-categories",channelId:c,requestedLevel:b,parentCategory:a,fileLanguage:e,nextCategoryNonce:MyAjax.nextCategoryNonce},function(f){f=f.trim();if(f.substr(f.length-1)==="0"){f=f.substring(0,f.length-1)}d(wppfm_validateResponse(f))})}function wppfm_getCategoryListsFromString(b,a,d,c){jQuery.post(MyAjax.ajaxurl,{action:"myajax-get-category-lists",channelId:b,mainCategories:a,fileLanguage:d,categoryListsNonce:MyAjax.categoryListsNonce},function(e){c(wppfm_validateResponse(e))})}function wppfm_updateFeedToDb(b,a,c){jQuery.post(MyAjax.ajaxurl,{action:"myajax-update-feed-data",feedId:b.feedId,channelId:b.channel,includeVariations:b.includeVariations,isAggregator:b.isAggregator,countryId:b.country,sourceId:b.dataSource,title:b.title,feedTitle:b.feedTitle,feedDescription:b.feedDescription,defaultCategory:b.mainCategory,url:b.url,status:b.status,schedule:b.updateSchedule,feedFilter:b.feedFilter?b.feedFilter[0]["meta_value"]:"",metaData:JSON.stringify(a),updateFeedDataNonce:MyAjax.updateFeedDataNonce},function(d){c(wppfm_validateResponse(d))})}function wppfm_updateFeedFile(b,c){var a=new Date();console.log("Feed update started at "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds());jQuery.post(MyAjax.ajaxurl,{action:"myajax-update-feed-file",dataType:"text",feedData:JSON.stringify(b),updateFeedFileNonce:MyAjax.updateFeedFileNonce},function(d){var f=new Date();var e=(f-a)/1000;console.log("Feed update ended at "+f.getHours()+":"+f.getMinutes()+":"+f.getSeconds()+" (runtime "+e+" seconds).");c(wppfm_validateResponse(d))})}function wppfm_getFeedData(a,b){jQuery.post(MyAjax.ajaxurl,{action:"myajax-get-feed-data",sourceId:a,feedDataNonce:MyAjax.feedDataNonce},function(c){b(wppfm_validateResponse(c))})}function wppfm_switchFeedStatus(a,b){jQuery.post(MyAjax.ajaxurl,{action:"myajax-switch-feed-status",feedId:a,switchFeedStatusNonce:MyAjax.switchFeedStatusNonce},function(c){b(wppfm_validateResponse(c))})}function wppfm_duplicateExistingFeed(a,b){jQuery.post(MyAjax.ajaxurl,{action:"myajax-duplicate-existing-feed",feedId:a,duplicateFeedNonce:MyAjax.duplicateFeedNonce},function(c){if(c.trim()){wppfm_resetFeedList()}b(wppfm_validateResponse(c))})}function wppfm_logMessageOnServer(a,c,b){jQuery.post(MyAjax.ajaxurl,{action:"myajax-log-message",messageList:a,fileName:c,logMessageNonce:MyAjax.logMessageNonce},function(d){b(d.trim())})}function wppfm_update_ftp_passive_mode(a,b){jQuery.post(MyAjax.ajaxurl,{action:"myajax-update-ftp-mode-selection",ftp_selection:a,updateFeedDataNonce:MyAjax.setFTPModeNonce},function(c){b(c.trim())})}function wppfm_auto_feed_fix_mode(a,b){jQuery.post(MyAjax.ajaxurl,{action:"myajax-auto-feed-fix-mode-selection",fix_selection:a,updateAutoFeedFixNonce:MyAjax.setAutoFeedFixNonce},function(c){b(c.trim())})}function wppfm_change_third_party_attribute_keywords(a,b){jQuery.post(MyAjax.ajaxurl,{action:"myajax-third-party-attribute-keywords",keywords:a,thirdPartyKeywordsNonce:MyAjax.setThirdPartyKeywordsNonce},function(c){b(c.trim())})}function wppfm_validateResponse(a){a=a.trim();if(a.indexOf("<div id='error'>")<0&&a.indexOf("<b>Fatal error</b>")<0&&a.indexOf("<b>Notice</b>")<0&&a.indexOf("<b>Warning</b>")<0&&a.indexOf("<b>Catchable fatal error</b>")<0&&a.indexOf('<div id="error">')<0){if(a.indexOf("[]")<0){if(a!==""){return(a)}else{return("1")}}else{return("0")}}else{wppfm_show_error_message(a.replace("[]",""));wppfm_hide_feed_spinner();wppfm_logMessageOnServer(a,"error",function(b){return("0")})}}function wppfm_deleteFeed(b,a){jQuery("#feed-list-message").empty();wppfm_removeFeedFile(function(){jQuery("#feed-spinner").show();wppfm_deleteFeedFromDb(b,function(c){jQuery("#feed-spinner").show();c=c.trim();if(c==="1"){wppfm_resetFeedList();wppfm_show_success_message('Removed file "'+a+'" from the server.');jQuery("#feed-spinner").hide()}else{jQuery("#feed-list-message").append(c);jQuery("#feed-spinner").hide()}},b)},a)}function wppfm_removeFeedFile(b,a){jQuery.post(MyAjax.ajaxurl,{action:"myajax-delete-feed-file",fileTitle:a,deleteFeedNonce:MyAjax.deleteFeedNonce},function(c){b(wppfm_validateResponse(c))})}function wppfm_deleteFeedFromDb(a,b){jQuery.post(MyAjax.ajaxurl,{action:"myajax-delete-feed",feedId:a,deleteFeedNonce:MyAjax.deleteFeedNonce},function(c){b(wppfm_validateResponse(c))})}function wppfm_initiateBackup(b,a){jQuery.post(MyAjax.ajaxurl,{action:"myajax-backup-current-data",fileName:b,backupNonce:MyAjax.backupNonce},function(c){a(wppfm_validateResponse(c))})}function wppfm_deleteBackup(b,a){jQuery.post(MyAjax.ajaxurl,{action:"myajax-delete-backup-file",fileName:b,deleteBackupNonce:MyAjax.deleteBackupNonce},function(c){a(wppfm_validateResponse(c))})}function wppfm_restoreBackup(b,a){jQuery.post(MyAjax.ajaxurl,{action:"myajax-restore-backup-file",fileName:b,restoreBackupNonce:MyAjax.restoreBackupNonce},function(c){a(wppfm_validateResponse(c))})}function wppfm_duplicateBackup(b,a){jQuery.post(MyAjax.ajaxurl,{action:"myajax-duplicate-backup-file",fileName:b,duplicateBackupNonce:MyAjax.duplicateBackupNonce},function(c){a(wppfm_validateResponse(c))})};