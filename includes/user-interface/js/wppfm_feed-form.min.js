/*!
 * feed-form.js v3.4
 * Part of the WP Product Feed Manager
 * Copyright 2017, Michel Jongbloed
 *
 */
"use strict";var $jq=jQuery.noConflict();var _mandatoryFields=[];var _highlyRecommendedFields=[];var _recommendedFields=[];var _undefinedRecommendedOutputs=[];var _definedRecommendedOutputs=[];var _optionalFields=[];var _undefinedOptionalOutputs=[];var _definedOptionalOutputs=[];var _undefinedCustomOutputs=[];var _customFields=[];var _inputFields=[];var _feedHolder;function wppfm_mainInputChanged(c){var b=$jq("#merchants").val();var a=_feedHolder.feedId;wppfm_reactOnChannelInputChanged(b,a,c)}function wppfm_file_name_changed(){_feedHolder.title=$jq("#file-name").val()}function wppfm_freeCategoryChanged(a,b){if(a==="default"){if(b){if(b>0){_feedHolder.setCustomCategory(undefined,$jq("#free-category-text-input").val())}else{wppfm_mainInputChanged(true)}}else{wppfm_mainInputChanged(true)}}else{_feedHolder.changeCustomFeedCategoryMap(b,$jq("#feed-category-"+b+" :input").val())}}function wppfm_constructNewFeed(){var r=$jq("#file-name").val();var i=parseInt($jq("#sources").val());var d=$jq("#lvl_0 option:selected").text();var p=[];var s=$jq("#merchants").val();var e=$jq("#variations").is(":checked")?1:0;var j=$jq("#aggregator").is(":checked")?1:0;var l=$jq("#countries").val();var q=$jq("#google-feed-title-selector").val();var h=$jq("#google-feed-description-selector").val();var g=$jq("#days-interval").val()!==""?$jq("#days-interval").val():"1";var o=$jq("update-schedule-hours").val()!==""?$jq("update-schedule-hours").val():"00";var n=$jq("update-schedule-minutes").val()!==""?$jq("update-schedule-minutes").val():"00";var f=$jq("update-schedule-frequency").val()!==""?$jq("update-schedule-frequency").val():"1";var m=[];var k=2;var a=wppfm_getChannelFeedType(s);var b=$jq("#wp-plugin-url").text()+"/wppfm-feeds/"+r+"."+a;var c=g+":"+o+":"+n+":"+f;wppfm_setScheduleSelector(g,f);_feedHolder=new Feed(-1,r,e,j,parseInt(s),d,p,b,i,l,q,h,c,m,k)}function wppfm_finishOrUpdateFeedPage(b){wppfm_show_feed_spinner();var a=$jq("#merchants").val().toString();_feedHolder.title=$jq("#file-name").val();_feedHolder.channel=$jq("#merchants").val();_feedHolder.includeVariations=$jq("#variations").is(":checked")?"1":"0";_feedHolder.isAggregator=$jq("#aggregator").is(":checked")?"1":"0";_feedHolder.feedTitle=$jq("#google-feed-title-selector").val();_feedHolder.feedDescription=$jq("#google-feed-description-selector").val();wppfm_outputFields(-1,a,function(c){_feedHolder.setUpdateSchedule($jq("#days-interval").val(),$jq("#update-schedule-hours").val(),$jq("#update-schedule-minutes").val(),$jq("#update-schedule-frequency").val());wppfm_addFeedAttributes(c,a,1);wppfm_customSourceFields(_feedHolder.dataSource,function(d){_feedHolder.country=$jq("#countries").val();wppfm_fillSourcesList(d);wppfm_mainFeedFilters(_feedHolder.feedId,function(g){var f=g!==1?g:null;_feedHolder.setFeedFilter(f);_feedHolder=wppfm_setOutputAttributeLevels(a,_feedHolder,_feedHolder.country);wppfm_makeFeedFilterWrapper(_feedHolder.feedId,_feedHolder.feedFilter);if(b){_feedHolder.mainCategory=$jq("#lvl_0").val()?$jq("#lvl_0").val():$jq("#free-category-text-input").val();_feedHolder.setMainCategory("lvl_0",$jq("#lvl_0").val(),a)}wppfm_makeFieldsTable();if(_feedHolder!==0){var e=_feedHolder.feedId===-1?true:false;wppfm_fillFeedFields(e,b)}_feedHolder.channel=a;wppfm_hide_feed_spinner()})})})}function wppfm_editExistingFeed(a){wppfm_show_feed_spinner();wppfm_getFeedObject(a,function(e){_feedHolder=e;var c=_feedHolder.channel;var b=_feedHolder.mainCategory;var d=b.indexOf(" > ")>-1?b.substring(0,b.indexOf(" > ")):b;wppfm_fillCategoryVariables(c,d,0);wppfm_outputFields(_feedHolder.feedId,c,function(f){wppfm_addFeedAttributes(f,c,1);wppfm_customSourceFields(_feedHolder.dataSource,function(g){wppfm_fillSourcesList(g);wppfm_mainFeedFilters(a,function(i){var h=i!==1?i:null;_feedHolder.setFeedFilter(h);_feedHolder=wppfm_setOutputAttributeLevels(c,_feedHolder,_feedHolder.country);wppfm_makeFeedFilterWrapper(_feedHolder.feedId,_feedHolder.feedFilter);wppfm_makeFieldsTable();if(_feedHolder!==0){wppfm_fillFeedFields(false,false)}if(_feedHolder.categoryMapping){wppfm_setCategoryMap(_feedHolder.categoryMapping)}wppfm_enableFeedActionButtons();$jq("#countries").prop("disabled",false);wppfm_fillDefaultCategorySelectors();wppfm_setIdentifierExistsDependancies();wppfm_hide_feed_spinner()})})})})}function wppfm_fillSourcesList(a){_inputFields=wppfm_woocommerceSourceOptions();wppfm_addCustomFieldsToInputFields(_inputFields,a);_inputFields.sort(function(d,c){return(""+d.label).toUpperCase()<(""+c.label).toUpperCase()?-1:1})}function wppfm_saveUpdateSchedule(){var d=$jq("#days-interval").val();var a=$jq("#update-schedule-hours").val();var b=$jq("#update-schedule-minutes").val();var c=$jq("#update-schedule-frequency").val();if(d!=="1"){c="1"}if(c===1){d="1"}wppfm_setScheduleSelector(d,c);_feedHolder.setUpdateSchedule(d,a,b,c)}function wppfm_setScheduleSelector(b,a){if(b==="1"){$jq("#wppfm-update-frequency-wrapper").show()}else{$jq("#wppfm-update-frequency-wrapper").hide()}if(a>1){$jq("#wppfm-update-day-wrapper").hide();$jq("#wppfm-update-every-day-wrapper").show()}else{$jq("#wppfm-update-day-wrapper").show();$jq("#wppfm-update-every-day-wrapper").hide()}}function wppfm_addCustomFieldsToInputFields(b,d){if(d!=="0"){for(var a=0;a<d.length;a++){var c={value:d[a].attribute_name,label:d[a].attribute_label,prop:"custom"};b.push(c)}}}function wppfm_fillDefaultCategorySelectors(){var b=_feedHolder.mainCategory;var a=_feedHolder.channel;var c=wppfm_channelCountryCode(a);wppfm_getCategoryListsFromString(a,b,c,function(f){var d=JSON.parse(f);if(d&&d.length>0&&b!==undefined){var e=b.split(" > ");for(var h=0;h<d.length;h++){$jq("#lvl_"+h).append(wppfm_categorySelectCntrl(d[h]));var g=document.getElementById("lvl_"+h);g.value=e[h]}}else{$jq("#lvl_0").prop("disabled",false)}})}function wppfm_google_feed_title_changed(){_feedHolder.feedTitle=$jq("#google-feed-title-selector").val()}function wppfm_google_feed_description_changed(){_feedHolder.feedDescription=$jq("#google-feed-description-selector").val()}function wppfm_setCategoryMap(a){var d=JSON.parse(a);for(var b=0;b<d.length;b++){var c=d[b].shopCategoryId;var e="";switch(d[b].feedCategories){case"wp_mainCategory":e=wppfm_mapToDefaultCategoryElement(c,"default");break;case"wp_ownCategory":e=wppfm_mapToDefaultCategoryElement(c,"shopCategory");break;default:e=wppfm_mapToCategoryElement(c,d[b].feedCategories);break}$jq("#feed-selector-"+c).prop("checked",true);$jq("#feed-category-"+c).html(e)}}function wppfm_generateAndSaveFeed(){wppfm_show_feed_spinner();_feedHolder.mainCategory=!wppfm_channelUsesOwnCategories(_feedHolder.channel)?_feedHolder.mainCategory:"no category required";wppfm_saveFeedToDb(_feedHolder,function(b){var a=_feedHolder.feedId===-1?true:false;if(b===0){console.log("Saving the data to the data base has failed!");wppfm_show_error_message("Saving the data to the data base has failed! Please try again.")}else{_feedHolder.feedId=b;if(a){var c=window.location.href;window.location.href=c+"&id="+_feedHolder.feedId}}wppfm_updateFeedFile(_feedHolder,function(d){if(d!=="1"&&d!==1&&!d.includes("successfully")){wppfm_show_error_message("Generating the xml file has failed! Return code = "+d+".");wppfm_hide_feed_spinner()}else{if(!a){wppfm_hide_feed_spinner()}if(d.includes("successfully")){wppfm_show_success_message(d)}}})})}function wppfm_saveFeed(){wppfm_show_feed_spinner();var a=_feedHolder.feedId===-1?true:false;_feedHolder.mainCategory=!wppfm_channelUsesOwnCategories(_feedHolder.channel)?_feedHolder.mainCategory:"no category required";if(a){_feedHolder.url="No feed generated"}wppfm_saveFeedToDb(_feedHolder,function(b){if(b===0){console.log("Saving the data to the data base has failed!");wppfm_show_error_message("Saving the data to the data base has failed! Please try again.")}else{_feedHolder.feedId=b;if(a){var c=window.location.href;window.location.href=c+"&id="+_feedHolder.feedId}}wppfm_hide_feed_spinner()})}function wppfm_nextCategory(a){var b=wppfm_incrementLast(a);var e=b.match(/(\d+)$/)[0];var d=$jq("#"+a).val();var c=_feedHolder.channel?_feedHolder.channel.toString():$jq("#merchants").val();var f=wppfm_channelCountryCode(c);if(e>1){wppfm_show_feed_spinner()}wppfm_hideSubs(a);wppfm_fillCategoryVariables(c,d,a);wppfm_getNextCategories(c,e,d,f,function(g){var h=JSON.parse(g);if(h.length>0){$jq("#"+b).append(wppfm_categorySelectCntrl(h));$jq("#"+b).show()}if(a.indexOf("catmap")>-1){wppfm_setChildCategories(a,d)}else{_feedHolder.setMainCategory(a,d,c);if(_feedHolder.attributes.length>0&&_feedHolder.attributes[3]["value"]!==undefined&&_feedHolder.attributes[3]["value"]!==""){$jq("#category-source-string").html(JSON.parse(_feedHolder.attributes[3]["value"]).t)}else{$jq("#category-source-string").html(_feedHolder.mainCategory)}}if(e>1){wppfm_hide_feed_spinner()}})}function wppfm_setChildCategories(c,f){var e=c.match(/(\d+)$/)[0];var g=c.replace("_"+e,"");var d=g.match(/(\d+)$/)[0];var b=$jq("#feed-selector-"+d).attr("data-children")?JSON.parse($jq("#feed-selector-"+d).attr("data-children")):[];for(var a=0;a<b.length;a++){wppfm_setChildrenToParentCategory(b[a],e,f)}_feedHolder.mapCategory(c,f)}function wppfm_variation_selection_changed(){alert("The option to add product variations to the feed is not available in the free version. Unlock this option by upgrading to the Premium plugin. For more information goto http://www.wpmarketingrobot.com/.");_feedHolder.changeIncludeVariations(false);$jq("#variations").prop("checked",false)}function wppfm_aggregatorChanged(){console.log(_feedHolder.attributes);if($jq("#aggregator").is(":checked")){_feedHolder.changeAggregator(true);_feedHolder.attributes[8]["fieldLevel"]="1"}else{_feedHolder.changeAggregator(false);_feedHolder.attributes[8]["fieldLevel"]="0";_feedHolder.deactivateAttribute("8")}}function wppfm_setChildrenToParentCategory(g,h,e){var a=$jq("#category-text-span-"+g).text();var f=wppfm_addNewItemToCategoryString(h,a,e," > ");var d="catmap-"+g+"_"+h;$jq("#category-text-span-"+g).text(f);var c=$jq("#feed-selector-"+g).attr("data-children")?JSON.parse($jq("#feed-selector-"+g).attr("data-children")):[];for(var b=0;b<c.length;b++){wppfm_setChildrenToParentCategory(c[b],h,e)}_feedHolder.mapCategory(d,e)}function wppfm_fillFeedFields(a,g){if(_feedHolder.mainCategory&&a===false){if(!g){var b=_feedHolder.mainCategory+' (<a class="edit-categories wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="categories" onclick="wppfm_editCategories()">edit</a>)';$jq("#lvl_0").hide();$jq("#selected-categories").html(b);$jq("#selected-merchant").html($jq("#merchants option[value='"+_feedHolder.channel+"']").text());$jq("#merchants").hide()}}else{$jq("#lvl_0").css("display","initial")}var e=_feedHolder.updateSchedule.split(":");if(!a){wppfm_showChannelInputs(_feedHolder.channel,a)}else{$jq("#category-map").show()}$jq("#file-name").val(_feedHolder.title);$jq("#merchants").val(_feedHolder.channel);$jq("#variations").prop("checked",_feedHolder.includeVariations>0?true:false);$jq("#aggregator").prop("checked",_feedHolder.isAggregator>0?true:false);$jq("#countries").val(_feedHolder.country);$jq("#google-feed-title-selector").val(_feedHolder.feedTitle);$jq("#google-feed-description-selector").val(_feedHolder.feedDescription);$jq("#days-interval").val(e[0]);var f=document.getElementById("update-schedule-hours");var d=document.getElementById("update-schedule-minutes");var c=document.getElementById("update-schedule-frequency");f.value=e[1];d.value=e[2];c.value=e[3]?e[3]:"1";wppfm_setScheduleSelector(e[0],e[3])}function wppfm_categorySelectCntrl(a){var c='<option value="0">Select a sub-category</option>';for(var b=0;b<a.length;b++){c+='<option value="'+a[b]+'">'+a[b]+"</option>"}return c}function wppfm_editCategoryMapping(c){var a=_feedHolder.channel;var b=wppfm_channelCountryCode(a);if(!wppfm_isCustomChannel(a)){wppfm_getCategoryListsFromString(a,"",b,function(d){var e=JSON.parse(d)[0];if(e&&e.length>0){$jq("#catmap-"+c+"_0").append(wppfm_categorySelectCntrl(e));$jq("#catmap-"+c+"_0").prop("disabled",false)}else{$jq("#catmap-"+c+"_0").prop("disabled",false)}$jq("#feed-category-"+c).html("");$jq("#category-selector-catmap-"+c).show()})}else{$jq("#feed-category-"+c).html(wppfm_freeCategoryInputCntrl("mapping",c,_feedHolder.mainCategory));$jq("#category-selector-catmap-"+c).hide()}}function wppfm_activateOptionalFieldRow(e,a){var c=_feedHolder.getAttributeIdByName(a);_feedHolder.activateAttribute(c);if(_feedHolder.attributes[c]["advisedSource"]){_feedHolder.setSourceValue(c,e,_feedHolder.attributes[c]["advisedSource"])}var b=wppfm_fieldRow(_feedHolder.attributes[c],true);var d=_undefinedRecommendedOutputs.indexOf(a);if(d>-1){_undefinedRecommendedOutputs.splice(d,1)}_definedRecommendedOutputs.push(_feedHolder.attributes[c]["fieldName"]);_definedRecommendedOutputs.sort();$jq("#output-field-cntrl-"+e).empty();$jq("#output-field-cntrl-"+e).html(wppfm_outputFieldCntrl(e));if(e===3){$jq("#new-recommended-row").append(b);$jq("#new-recommended-row").show()}else{if(e===4){$jq("#new-optional-row").append(b)}}}function wppfm_deactivateOptionalFieldRow(b,c,a){_feedHolder.deactivateAttribute(b);$jq("#output-field-cntrl-"+c).append("<option value='"+a+"'>"+a+"</option>");$jq("#row-"+b).html("");$jq("#new-recommended-row").hide()}function wppfm_activateCustomFieldRow(b){if(!_feedHolder.checkIfCustomNameExists(b)){var a=_feedHolder.getAttributeIdByName(b);_feedHolder.addAttribute(a,b,"",undefined,"5",true,0,0,0,0);$jq("#new-custom-row").append(wppfm_fieldRow(_feedHolder.attributes[a],true));$jq("#new-custom-row").show()}else{alert("You already have a field "+b+" defined!")}console.log(_feedHolder.attributes);$jq("#custom-output-title-input").val("")}function wppfm_setStaticValue(b,a,d){console.log(b);console.log(a);console.log(d);console.log(_feedHolder.attributes[b]["value"]);var c=$jq("#static-input-field-"+b+"-"+a+"-"+d).val();if(c===undefined){c=$jq("#static-condition-input-"+b+"-"+a+"-"+d+" option:selected").text()}_feedHolder.setStaticAttributeValue(b,a,d,c)}function wppfm_setIdentifierExistsDependancies(){var a=$jq("#static-input-field-34-0").val();if(a===undefined){a=$jq("#static-condition-input-34-0 option:selected").text()}switch(a){case"true":wppfm_resetOutputField(12,1,true);wppfm_resetOutputField(13,1,true);break;case"false":wppfm_resetOutputField(12,3,false);wppfm_resetOutputField(13,3,false);break;default:break}}function wppfm_resetOutputField(b,f,c){var d=_feedHolder.attributes[b]["fieldLevel"];_feedHolder.attributes[b]["fieldLevel"]=f;_feedHolder.attributes[b]["isActive"]=c;var a=wppfm_fieldRow(_feedHolder.attributes[b],false);var e=_feedHolder.attributes[b]["fieldName"];if(c){$jq("#required-field-table").append(a);$jq("#output-field-cntrl-"+d+" option[value='"+e+"']").remove();$jq("#recommended-field-table #row-"+b).remove()}else{$jq("#row-"+b).replaceWith("");$jq("#output-field-cntrl-"+f).append('<option value="'+e+'">'+e+"</option>")}}function wppfm_fieldRow(f,a){var g=f.rowId;var d=_feedHolder.getSourceObject(g);var b=countSources(d.mapping);if(d.advisedSource&&wppfm_hasExtraSourceRow(b,d.mapping)){b++}var e='<div class="field-table-row-wrapper" id="row-'+g+'">';for(var c=0;c<b;c++){e+=wppfm_addFeedSourceRow(g,c,d,_feedHolder.channel,a)}for(var c=0;c<d.changeValues.length;c++){if(d.changeValues[0]){e+=wppfm_valueEditor(d.rowId,c,c,d.changeValues)}}e+=wppfm_endrow(g);e+="</div>";return e}function wppfm_addSourceDataAndQueriesColumn(c,o){var k="";var d=o.rowId+"-"+c;var m=wppfm_getMappingSourceValue(o.mapping,c);var f=wppfm_getMappingCombinedValue(o.mapping,c);var h=wppfm_getMappingStaticValue(o.mapping,c);var b=o.customCondition?true:false;var a=m||f||h?true:false;var g=_feedHolder.channel.toString();var l=wppfm_getMappingConditions(o.mapping,c);var n=wppfm_countObjectItems(l);k+='<div class="source-selector colw col30w" id="source-select-'+d+'">';if(b){k+=wppfm_categorySource()}else{if((o.advisedSource&&!a&&o.advisedSource!=="Fill with a static value")||o.advisedSource===m){var j=$jq.grep(_inputFields,function(i){return i.value===o.advisedSource});j=j[0]?j[0].label:o.advisedSource;k+=wppfm_advisedSourceSelector(o.rowId,c,j,g,o.mapping)}else{if((!o.advisedSource&&!m)||a||o.advisedSource==="Fill with a static value"){k+=wppfm_inputFieldCntrl(o.rowId,c,m,h,o.advisedSource,f,wppfm_isCustomChannel(g));if(h){k+=wppfm_feedStaticValueSelector(o.fieldName,o.rowId,c,0,h,g)}if(f){k+=wppfm_combinedField(o.rowId,c,0,f,false,g)}}}}k+="</div>";k+='<div class="condition-selector colw" id="condition-data-'+d+'">';if(!b&&!l){k+='<div class="condition-wrapper" id="condition-'+d+'-0">';k+=wppfm_forAllProductsCondition(o.rowId,c,"initial");k+="</div>"}else{if(l){for(var e=0;e<n;e++){k+=wppfm_conditionSelectorCode(o.rowId,c,e,n,l[e])}}}k+="</div>";return k}function wppfm_addCombinedField(b,a,h){var c=true;for(var d=0;d<h;d++){if($jq("#combined-input-field-cntrl-"+b+"-"+a+"-"+h).val()==="select"){c=false;d=h}if($jq("#combined-input-field-cntrl-"+b+"-"+a+"-"+h).val()==="static"&&$jq("#static-input-field-"+b+"-"+a+"-"+h).val()===""){c=false;d=h}}if(c){console.log(_feedHolder.attributes[b]);var f=_feedHolder.attributes[b]["value"]?JSON.parse(_feedHolder.attributes[b]["value"]):{};var g="m" in f?f.m:{};var e=wppfm_getMappingCombinedValue(g,a);var j=h>0?true:false;$jq("#source-select-"+b+"-"+a).append(wppfm_combinedField(b,a,h,e,j));$jq("#add-combined-field-"+b+"-"+a--).hide()}else{alert("Make sure to select all source fields before adding a new one!")}}function wppfm_combinedField(c,a,j,e,l){$jq("#combined-wrapper-"+c+"-"+a).remove();var f=e?e.split("|"):[];var k=e?f.length:2;if(l){k++}var h='<div class="combined-wrapper" id="combined-wrapper-'+c+"-"+a+'">';for(var d=0;d<k;d++){var g=f[d];var b=g?g.indexOf("#"):0;if(g){var m=g.substr(0,b)!=="static"?[g.substr(0,b),g.substr(b+1)]:["0",f[d]]}else{var m=[]}h+=wppfm_combinedCntrl(c,a,d+1,k,"delete",m,_feedHolder.channel)}h+="</div>";return h}function wppfm_combinedCntrl(b,a,d,c,g,h,e){var f="";var i=_feedHolder.attributes[b]["fieldName"];f+='<span class="combined-field-row" id="combined-field-row-'+b+"-"+a+"-"+d+'">';if(d>1){f+=wppfm_combinedSeparatorCntrl(b,a,d,h[0])}f+=wppfm_combinedInputFieldCntrl(b,a,d,h[1],i,e);if(g==="initialize"){f+='<span class="combined-field-row" id="combined-field-row">';f+=wppfm_combinedSeparatorCntrl(b,a,d,h[0]);f+=wppfm_combinedInputFieldCntrl(b,a,2,"",i,e);f+='<div class="static-value-control" id="static-value-control-'+b+"-"+a+'-2"></div>'}if(d>2){f+='<span id="remove-combined-field-'+b+"-"+a+"-"+d+'" style="display:initial">';f+='(<a class="remove-combined-field wppfm-btn wppfm-btn-small" href="javascript:void(0)"';f+=' onclick="wppfm_removeCombinedField('+b+", "+a+", "+d+')">remove</a>)</span>'}if(d===2||d>=c){if(d===1){d++}if(d>=c){f+='<span id="add-combined-field-'+b+"-"+a+"-"+d+'" style="display:initial">';f+='(<a class="add-combined-field wppfm-btn wppfm-btn-small" href="javascript:void(0)"';f+=' onclick="wppfm_addCombinedField('+b+", "+a+", "+d+')">add</a>)</span>'}}f+="</span>";return f}function wppfm_ifConditionSelector(c,b,h,a,g){var d="";var e=wppfm_isEmptyQueryObject(g)?wppfm_makeCleanQueryObject():g;var i="if ";if(h>1){i=e.preCondition==="1"?'<select id="sub-condition-'+c+"-"+b+"-"+h+'" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')"><option value="2">or</option><option value="1" selected>and</option></select>':'<select id="sub-condition-'+c+"-"+b+"-"+h+'" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')"><option value="2" selected>or</option><option value="1">and</option></select>'}var f="wppfm_storeCondition("+c+", "+b+", "+h+")";d+='<div class="condition-wrapper" id="condition-'+c+"-"+b+"-"+h+'">';d+=i;d+=wppfm_conditionFieldCntrl(c,b,h,-1,"input-field-cntrl",e.source,f);d+=wppfm_conditionQueryCntrl(c,b,h,-1,"query-condition","wppfm_queryConditionChanged",e.condition);d+='<input type="text" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')" name="condition-value" id="condition-value-';d+=c+"-"+b+"-"+h+'" value="'+e.value+'"';if(g.condition!=="4"&&g.condition!=="5"){d+=' style="display:initial">'}else{d+=' style="display:none;">'}if(g.condition!=="14"){d+='<span id="condition-and-value-'+c+"-"+b+"-"+h+'" style="display:none;"> and <input type="text" name="condition-and-value" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')" id="condition-and-value-input-'+c+"-"+b+"-"+h+'"></span>'}else{d+='<span id="condition-and-value-'+c+"-"+b+"-"+h+'" style="display:initial"> and <input type="text" name="condition-and-value" onchange="wppfm_storeCondition('+c+", "+b+", "+h+')" id="condition-and-value-input-'+c+"-"+b+"-"+h+'" value="'+g.endValue+'"></span>'}d+='(<a class="remove-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="'+c;d+='" onclick="wppfm_removeCondition('+c+", "+b+", "+(h-1)+')">remove</a>)';if(h>=a){d+='<span id="add-edit-condition-'+c+"-"+b+"-"+h+'" style="display:initial"> (<a class="add-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)';d+='" onclick="wppfm_addCondition('+c+", "+b+", "+h+", '')\">add</a>)</span>"}d+="</div>";return d}function wppfm_orConditionSelector(d,b){var c=b.split("#");var e="";var a="";if(c[0]==="static"){e=wppfm_displayCorrectStaticField(d,1,0,_feedHolder.channel,_feedHolder.attributes[d]["fieldName"],c[1]);b="static"}a+="or ";a+=wppfm_alternativeInputFieldCntrl(d,b);a+='<span id="alternative-static-input-'+d+'">'+e+"</span>";a+=" for all other products ";a+='(<a class="edit-prod-source wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="edit-prod-source-'+d+'" onclick="addSource('+d+", 0, '')\">";a+="edit</a>)";return a}function wppfm_ifValueQuerySelector(b,a,d,h,g){var e="";var f=wppfm_isEmptyQueryObject(h)?wppfm_makeCleanQueryObject():h;var c="if ";var i="wppfm_queryValueConditionChanged("+b+", "+a+", "+d+", 0)";if(d>1){c=f.preCondition==="1"?'<select id="value-options-sub-query-'+b+"-"+a+"-"+d+'" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')"><option value="2">or</option><option value="1" selected>and</option></select>':'<select id="value-options-sub-query-'+b+"-"+a+"-"+d+'" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')"><option value="2" selected>or</option><option value="1">and</option></select>'}e+='<div class="value-options-query-selector" id="value-options-condition-'+b+"-"+a+"-"+d+'">';e+=c;e+=wppfm_conditionFieldCntrl(b,a,d,-1,"value-options-input-field-cntrl",f.source,i);e+=wppfm_conditionQueryCntrl(b,a,d,0,"value-query-condition","wppfm_queryValueConditionChanged",f.condition);if(h.condition!=="4"&&h.condition!=="5"){e+='<input type="text" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')" name="value-options-condition-value" id="value-options-condition-value-';e+=b+"-"+a+"-"+d+'" value="'+f.value+'" style="display:initial">'}if(h.condition!=="14"){e+='<span id="value-options-condition-and-value-'+b+"-"+a+"-"+d+'" style="display:none;"> and ';e+='<input id="value-options-condition-and-value-input-'+b+"-"+a+"-"+d+'" ';e+='type="text" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')" name="value-condition-and-value"></span>'}else{e+='<span id="value-options-condition-and-value-'+b+"-"+a+"-"+d+'" style="display:initial"> and ';e+='<input id="value-options-condition-and-value-input-'+b+"-"+a+"-"+d+'" ';e+='type="text" onchange="wppfm_storeValueCondition('+b+", "+a+", "+d+')" name="value-condition-and-value" value="'+h.endValue+'"></span>'}e+='(<a class="remove-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="'+b;e+='" onclick="wppfm_removeValueQuery('+b+", "+a+", "+d+')">remove</a>)';if(g){e+='<span id="value-options-add-edit-condition-'+b+"-"+a+"-"+d+'" style="display:initial">(<a class="add-edit-condition wppfm-btn wppfm-btn-small" href="javascript:void(0)';e+='" onclick="wppfm_addValueQuery('+b+", "+a+", "+d+", '')\">add</a>)</span>"}e+="</div>";return e}function wppfm_addRequiredFieldRow(){}function wppfm_addOptionalFieldRow(c){var b="";var a=false;if(c===3){a=_undefinedRecommendedOutputs.length>0?true:false}else{if(c===4){a=_undefinedOptionalOutputs.length>0?true:false}else{if(c===5){a=true}}}if(a===true){if(c===3){b+='<div class="field-table-row-wrapper" id="new-recommended-row" style="display:none;"></div>'}else{if(c===4){b+='<div class="field-table-row-wrapper" id="new-optional-row"></div>'}else{if(c===5){b+='<div class="field-table-row-wrapper" id="new-custom-row"></div>'}}}b+='<div class="field-table-row-top">';b+='<div class="col2w" id="output-select-'+c;b+=c!==5?'" onchange="wppfm_changedOutputSelection('+c+')">'+wppfm_outputFieldCntrl(c):'">'+wppfm_customOutputFieldCntrl();b+="</div></div>"}return b}function wppfm_editOutput(c,b){var a="";a+=wppfm_inputFieldCntrl(c,b,"","",_feedHolder.attributes[c]["advisedSource"],"",false);a+='<div class="field-table-row-combined-selection" id="combined-selectors-'+c+'" style="display:none;"></div>';$jq("#source-select-"+c+"-"+b).html(a)}function wppfm_removeCondition(g,f,a){_feedHolder.removeValueConditionValue(g,f,a);var b=_feedHolder.getAttributesQueriesObject(g,f);var e=wppfm_countObjectItems(b);for(var d=1;d<e+2;d++){$jq("#condition-"+g+"-"+f+"-"+d).remove()}if(e>0){for(var c=0;c<e;c++){wppfm_conditionCode(g,f,c,b[c],e)}$jq("#edit-conditions-"+g).append(wppfm_orSelectorCode(g,""))}else{var h='<div class="condition-wrapper" id="condition-'+g+"-"+f+'-0">'+wppfm_forAllProductsCondition(g,f,"initial")+"</div>";$jq("#condition-data-"+g+"-"+f).html(h);$jq("#source-"+g+"-"+(f+1)).remove()}}function wppfm_removeValueQuery(f,e,d){_feedHolder.removeValueQueryValue(f,e,d);var a=_feedHolder.getValueQueryValue(f,e);var c=wppfm_countObjectItems(a);if(!_feedHolder.attributes[f]["value"]){_feedHolder.deactivateAttribute(f)}$jq("#value-editor-queries-"+f+"-"+e+"-0").empty();$jq("#edit-conditions-"+f).empty();console.log(c);if(c>0){for(var b=0;b<c;b++){wppfm_addValueQuery(f,e,b,a[b])}$jq("#edit-conditions-"+f).append(wppfm_orSelectorCode(f,""))}else{$jq("#value-editor-input-query-span-"+f+"-"+e+"-0").show();_feedHolder.removeEditValueValue(f,(e+1),0);$jq("#edit-value-span-"+f+"-"+(e+1)+"-0").remove()}}function wppfm_removeRow(b,e){var d="0";var a=_definedRecommendedOutputs.indexOf(e);var c=_definedOptionalOutputs.indexOf(e);_feedHolder.deactivateAttribute(b);$jq("#row-"+b).remove();if(a>-1){_definedRecommendedOutputs.splice(a,1);d=3;_undefinedRecommendedOutputs.push(e);_undefinedRecommendedOutputs.sort()}if(c>-1){_definedOptionalOutputs.splice(c,1);d=4;_undefinedOptionalOutputs.push(e);_undefinedOptionalOutputs.sort()}$jq("#output-field-cntrl-"+d).empty();$jq("#output-field-cntrl-"+d).html(wppfm_outputFieldCntrl(d))}function wppfm_addCondition(d,c,a,b){var e=wppfm_conditionCode(d,c,a,b,0);if(e){if(a===0){$jq(wppfm_addFeedSourceRow(d,c+1,_feedHolder.getSourceObject(d))).insertAfter("#source-"+d+"-"+c,false)}if(_feedHolder.attributes[d]["advisedSource"]){_feedHolder.setSourceValue(d,(c+1),_feedHolder.attributes[d]["advisedSource"])}}}function wppfm_conditionCode(c,a,i,g,d){if(g||wppfm_source_is_filled(c,a,i)){var j=$jq("#query-condition-"+c+"-"+a+"-"+i).val();var b=$jq("#input-field-cntrl-"+c+"-"+a+"-"+i).val();var f=$jq("#condition-value-"+c+"-"+a+"-"+i).val();var e=false;if(j!=="4"&&j!=="5"&&j!=="14"){if(b==="select"||f===""){e=true}}else{if(j===4||j===5){if(b==="select"){e=true}}}if(e===false||i===0){_feedHolder.incrNrQueries(c);var h=wppfm_queryStringToQueryObject(g);if(i===0){$jq("#condition-"+c+"-"+a+"-0").remove()}$jq("#condition-data-"+c+"-"+a).append(wppfm_ifConditionSelector(c,a,i+1,d,h));if(i>0){$jq("#add-edit-condition-"+c+"-"+a+"-"+i).remove()}return true}else{alert("Please fill in the current condition before adding a new one!");return false}}else{alert("Please select a source field first before you select the conditions.");return false}}function wppfm_addValueQuery(d,a,f,h){if(wppfm_source_is_filled(d,a,f)){var i=$jq("#value-query-condition-"+d+"-"+a+"-"+f+"-0").val();var c=$jq("#value-options-input-field-cntrl-"+d+"-"+a+"-"+f).val();var g=$jq("#value-options-condition-value-"+d+"-"+a+"-"+f).val();var e=false;if(i!=="4"&&i!=="5"&&i!=="14"){if(c==="select"||g===""){e=true}}else{if(i===4||i===5){if(c==="select"){e=true}}}if(e===false||a===0){var b=wppfm_queryStringToQueryObject(h);$jq("#value-options-add-edit-condition-"+d+"-"+a+"-"+f).hide();$jq("#value-editor-queries-"+d+"-"+a+"-0").append(wppfm_ifValueQuerySelector(d,a,f+1,b,true))}else{alert("Please fill in the current condition before adding a new one!")}}else{alert("Please select a source field first before you select the conditions.")}}function wppfm_conditionSelectorCode(f,d,e,a,c){var b=wppfm_queryStringToQueryObject(c);return wppfm_ifConditionSelector(f,d,e+1,a,b)}function wppfm_orSelectorCode(d,a){var c="";if(a){for(var b in a){c=a[b]}}return'<div class="or-selector" id="or-selector-'+d+'">'+wppfm_orConditionSelector(d,c)+"</div>"}function wppfm_showEditValueQuery(e,d,b,c){console.log(e);console.log(d);console.log(b);console.log(c);var a={};$jq("#value-editor-queries-"+e+"-"+d+"-"+b).html(wppfm_ifValueQuerySelector(e,d,b+1,a,c));$jq("#value-editor-input-query-span-"+e+"-"+d+"-0").hide();if(b===0&&c){wppfm_addRowValueEditor(e,d+1,0,"")}}function wppfm_changedOutput(f,d,h){var b=$jq("#input-field-cntrl-"+f+"-"+d).val();var g=0;switch(b){case"advised":if(f!==3){var c="";if(h!=="Use the settings in the Merchant Center"){var a=wppfm_sourceOptionsConverter(h);c='<div class="advised-source">'+a+wppfm_editSourceSelector(f,d)+"</div>"}else{c='<div class="advised-source">Use the settings in the Merchant Center '+wppfm_editSourceSelector(f,d)+"</div>"}$jq("#source-select-"+f+"-"+d).html(c);_feedHolder.clearSourceValue(f,d);_feedHolder.deactivateAttribute(f)}else{var c='<span id="category-source-string">'+_feedHolder.mainCategory+"</span>"+wppfm_editSourceSelector(f,d);_feedHolder.setCategoryValue(f,_feedHolder.mainCategory);$jq("#source-select-"+f+"-"+d).html(c)}break;case"static":$jq("#source-select-"+f+"-"+d).append(wppfm_displayCorrectStaticField(f,d,0,_feedHolder.channel,_feedHolder.attributes[f]["fieldName"],""));$jq("#combined-wrapper-"+f+"-"+d).remove();var e=$jq("#static-input-field-"+f+"-"+d+"-"+g).val()?$jq("#static-input-field-"+f+"-"+d+"-"+g).val():$jq("#static-condition-input-"+f+"-"+d+"-"+g+" option:selected").text();_feedHolder.setStaticAttributeValue(f,d,g,e);if(e||d>0){_feedHolder.activateAttribute(f)}else{_feedHolder.deactivateAttribute(f)}break;case"select":_feedHolder.clearSourceValue(f,d);if(d==="0"){_feedHolder.deactivateAttribute(f)}$jq("#static-input-field-"+f+"-"+d+"-"+g).remove();$jq("#static-condition-input-"+f+"-"+d+"-"+g).remove();$jq("#combined-wrapper-"+f+"-"+d).remove();wppfm_clearStaticField(f);break;case"combined":_feedHolder.setSourceValue(f,d,b);if(d==="0"){_feedHolder.deactivateAttribute(f)}$jq("#static-input-field-"+f+"-"+d+"-"+g).remove();$jq("#static-condition-input-"+f+"-"+d+"-"+g).remove();wppfm_addCombinedField(f,d,0);break;case"category_mapping":_feedHolder.setCustomCategory(f,_feedHolder.mainCategory);$jq("#static-input-field-"+f+"-"+d+"-"+g).remove();$jq("#static-condition-input-"+f+"-"+d+"-"+g).remove();$jq("#combined-wrapper-"+f+"-"+d).remove();$jq("#condition-"+f+"-"+d+"-0").remove();$jq("#value-editor-input-query-add-span-"+f+"-"+d+"-0").hide();$jq("#source-select-"+f+"-"+d).html(wppfm_categorySource());break;default:$jq("#static-input-"+f).html("");if(b===h&&d==="0"&&$jq("#input-field-cntrl-"+f+"-"+d+"-0").val()==="select"){_feedHolder.clearSourceValue(f,d)}else{_feedHolder.setSourceValue(f,d,b)}_feedHolder.activateAttribute(f);_feedHolder.attributes[f]["isActive"]=true;$jq("#static-input-field-"+f+"-"+d+"-"+g).remove();$jq("#static-condition-input-"+f+"-"+d+"-"+g).remove();$jq("#combined-wrapper-"+f+"-"+d).remove();break}}function wppfm_changedAlternativeSource(c){var d=1;var a=$jq("#alternative-input-field-cntrl-"+c).val();if(a==="static"){var b=wppfm_displayCorrectStaticField(c,_feedHolder.channel,d,_feedHolder.attributes[c]["fieldName"],"");$jq("#alternative-static-input-"+c).html(b)}else{$jq("#alternative-static-input-"+c).empty();if(a!=="select"&&a!=="empty"){_feedHolder.setAlternativeSourceValue(c,d,a)}else{_feedHolder.removeAlternativeSourceValue(c,d)}}}function wppfm_changedCombinationSeparator(b,a,c){wppfm_changedCombinedOutput(b,a,c)}function wppfm_changedCombinedOutput(e,d,f){var b=$jq("#combined-input-field-cntrl-"+e+"-"+d+"-"+f).val();var a="";switch(b){case"static":if(!$jq("#static-input-field-"+e+"-"+d+"-"+f).val()){var c=wppfm_displayCorrectStaticField(e,d,f,_feedHolder.channel,_feedHolder.attributes[e]["fieldName"],"");$jq("#static-value-control-"+e+"-"+d+"-"+f).html(c)}break;default:$jq("#static-value-control-"+e+"-"+d+"-"+f).empty();break}a=getCombinedValue(e,d);if(a){_feedHolder.setCombinedOutputValue(e,d,a);_feedHolder.activateAttribute(e)}else{_feedHolder.removeCombinedOutputValue(e,d,f);if(d==="0"){_feedHolder.deactivateAttribute(e)}}}function wppfm_removeCombinedField(f,d,c){_feedHolder.removeCombinedOutputValue(f,d,c);var b=JSON.parse(_feedHolder.attributes[f]["value"]);var e="m" in b?b.m:{};var a=wppfm_getMappingCombinedValue(e,d);$jq("#source-select-"+f+"-"+d).append(wppfm_combinedField(f,d,c,a,false))}function wppfm_clearStaticField(a){$jq("#static-input-"+a).html("")}function wppfm_storeValueCondition(d,k,f){var a=$jq("#value-options-input-field-cntrl-"+d+"-"+k+"-"+f).val();if(a!=="select"){var i;var j=f>1?$jq("#value-options-sub-query-"+d+"-"+k+"-"+f+" option:selected").val():"0";var c=$jq("#value-query-condition-"+d+"-"+k+"-"+f+"-0 option:selected").val();var h=c!=="4"&&c!=="5"?$jq("#value-options-condition-value-"+d+"-"+k+"-"+f).val():"";var e=c==="14"?$jq("#value-options-condition-and-value-input-"+d+"-"+k+"-"+f).val():"";if(c==="4"||c==="5"){i=true}else{if(c==="14"){i=h&&e?true:false}else{i=h?true:false}}if(i===true){var b=j!==""?j+"#":"0#";var g=b+a+"#"+c;if(h){g+="#"+h}if(e){g+="#0#"+e}_feedHolder.addValueQueryValue(d,k,f,g)}}else{console.log("Query "+d+"-"+k+"-"+f+" removed!");_feedHolder.removeValueQueryValue(d,k,f)}}function wppfm_storeCondition(e,c,k){var a=$jq("#input-field-cntrl-"+e+"-"+c+"-"+k).val();var l=false;if(wppfm_validSourceSelected(e,c)){if(a!=="select"){var i;var j=k>1?$jq("#sub-condition-"+e+"-"+c+"-"+k+" option:selected").val():"0";var d=$jq("#query-condition-"+e+"-"+c+"-"+k+" option:selected").val();var h=d!=="4"&&d!=="5"?$jq("#condition-value-"+e+"-"+c+"-"+k).val():"";var f=d==="14"?$jq("#condition-and-value-input-"+e+"-"+c+"-"+k).val():"";if(d==="4"||d==="5"){i=true}else{if(d==="14"){i=h&&f?true:false}else{i=h?true:false}}if(i===true){var b=j!==""?j+"#":"0#";var g=b+a+"#"+d;if(h){g+="#"+h}if(f){g+="#0#"+f}_feedHolder.addConditionValue(e,g,c,k);l=true}}else{_feedHolder.removeValueConditionValue(e,c,k)}}else{$jq("#input-field-cntrl-"+e+"-"+c+"-1").prop("selectedIndex",0);$jq("#condition-value-"+e+"-"+c+"-1").val("");alert("Please select a valid source before adding a condition to that source.")}return l}function wppfm_validSourceSelected(c,b){var a=$jq("#input-field-cntrl-"+c+"-"+b).val();switch(a){case"select":return false;case"static":if($jq("#static-condition-input-"+c+"-"+b+"-0").val()){return $jq("#static-condition-input-"+c+"-"+b+"-0").val()?true:false}else{if($jq("#static-input-field-"+c+"-"+b+"-0").val()){return $jq("#static-input-field-"+c+"-"+b+"-0").val()?true:false}else{return false}}case"combined":return $jq("#combined-input-field-cntrl-"+c+"-"+b+"-2").val()!=="select"?true:false;default:return true}}function wppfm_valueInputOptionsChanged(d,b,g){var f=$jq("#value-options-"+d+"-"+b+"-"+g+" option:selected").text();var h=$jq("#value-options-input-"+d+"-"+b+"-"+g).val();var i="";var e=b>0?"and":"change";if(f!=="replace"&&f!=="recalculate"){i=e+"#"+f+"#";i+=f==="change nothing"?"blank":h;console.log(d);console.log(b);console.log(g);console.log(f);console.log(h);console.log(i);_feedHolder.addChangeValue(d,b,g,i)}else{if(f==="replace"){var a=$jq("#value-options-input-with-"+d+"-"+b+"-"+g).val();if(h&&a){i=e+"#"+f+"#"+h+"#"+a;_feedHolder.addChangeValue(d,b,g,i)}}else{if(f==="recalculate"){var c=$jq("#value-options-recalculate-options-"+d+"-"+b+"-"+g+" option:selected").text();if(h){i=e+"#"+f+"#"+c+"#"+h;_feedHolder.addChangeValue(d,b,g,i)}}}}}function wppfm_removeValueEditor(e,d,f){_feedHolder.removeEditValueValue(e,d,f);var a=_feedHolder.getAttributesValueObject(e);var c=wppfm_countObjectItems(a);if(!_feedHolder.attributes[e]["value"]){_feedHolder.deactivateAttribute(e)}$jq("#edit-value-span-"+e+"-"+d+"-0").remove();if(c>0){for(var b=1;b<c;b++){wppfm_addRowValueEditor(e,d,b,a[b])}}else{$jq("#value-editor-"+e+"-"+d+"-"+f).remove();$jq("#source-"+e+"-"+d).append(wppfm_editValueSpan(e,d,f,"initial"))}}function wppfm_makeFieldsTable(){var b=_feedHolder.channel.toString();wppfm_resetFields();for(var a=0;a<_feedHolder.attributes.length;a++){switch(_feedHolder.attributes[a]["fieldLevel"]){case"1":_mandatoryFields+=wppfm_fieldRow(_feedHolder.attributes[a],false);break;case"2":_highlyRecommendedFields+=wppfm_fieldRow(_feedHolder.attributes[a],false);break;case"3":if(_feedHolder.attributes[a]["isActive"]){_recommendedFields+=wppfm_fieldRow(_feedHolder.attributes[a],true);_definedRecommendedOutputs.push(_feedHolder.attributes[a]["fieldName"])}else{_undefinedRecommendedOutputs.push(_feedHolder.attributes[a]["fieldName"])}break;case"4":if(_feedHolder.attributes[a]["isActive"]){_optionalFields+=wppfm_fieldRow(_feedHolder.attributes[a],true);_definedOptionalOutputs.push(_feedHolder.attributes[a]["fieldName"])}else{_undefinedOptionalOutputs.push(_feedHolder.attributes[a]["fieldName"])}break;case"5":if(_feedHolder.attributes[a]["isActive"]){_customFields+=wppfm_fieldRow(_feedHolder.attributes[a],true)}else{_undefinedCustomOutputs.push(_feedHolder.attributes[a]["fieldName"])}break;default:break}}_definedRecommendedOutputs.sort();_undefinedRecommendedOutputs.sort();_recommendedFields+=wppfm_addOptionalFieldRow(3);_optionalFields+=wppfm_addOptionalFieldRow(4);if(wppfm_isCustomChannel(b)){_customFields+=wppfm_addOptionalFieldRow(5)}if(_mandatoryFields.length>0){$jq("#required-field-table").html(_mandatoryFields);$jq("#required-fields").show()}else{$jq("#required-fields").hide()}if(_highlyRecommendedFields.length>0){$jq("#highly-recommended-field-table").html(_highlyRecommendedFields);$jq("#highly-recommended-fields").show()}else{$jq("#highly-recommended-fields").hide()}if(_recommendedFields.length>0){$jq("#recommended-field-table").html(_recommendedFields);$jq("#recommended-fields").show()}else{$jq("#recommended-fields").hide()}if(_optionalFields.length>0){$jq("#optional-field-table").html(_optionalFields);$jq("#optional-fields").show()}else{$jq("#optional-fields").hide()}if(_customFields.length>0){$jq("#custom-field-table").html(_customFields);$jq("#custom-fields").show()}else{$jq("#custom-fields").hide()}$jq("#fields-form").show(300)}function wppfm_resetFields(){_mandatoryFields=[];_highlyRecommendedFields=[];_recommendedFields=[];_undefinedRecommendedOutputs=[];_optionalFields=[];_undefinedOptionalOutputs=[];_customFields=[];_undefinedCustomOutputs=[]}function wppfm_queryConditionChanged(e,d,a){var c=$jq("#query-condition-"+e+"-"+d+"-"+a).val();if(c==="4"||c==="5"){$jq("#condition-value-"+e+"-"+d+"-"+a).hide()}else{$jq("#condition-value-"+e+"-"+d+"-"+a).show()}if(c==="14"){$jq("#condition-value-"+e+"-"+d+"-"+a).show();$jq("#condition-and-value-"+e+"-"+d+"-"+a).show()}else{$jq("#condition-and-value-"+e+"-"+d+"-"+a).hide()}var b=wppfm_storeCondition(e,d,a);if(b&&!$jq("#source-"+e+"-"+(d+1)).length){$jq(wppfm_addFeedSourceRow(e,d+1,_feedHolder.getSourceObject(e))).insertAfter("#source-"+e+"-"+d,false)}}function wppfm_queryValueConditionChanged(e,c,a,d){var b=$jq("#value-query-condition-"+e+"-"+c+"-"+a+"-"+d).val();if(b==="4"||b==="5"){$jq("#value-options-condition-value-"+e+"-"+c+"-"+a).hide()}else{$jq("#value-options-condition-value-"+e+"-"+c+"-"+a).show()}if(b==="14"){$jq("#value-options-condition-value-"+e+"-"+c+"-"+a).show();$jq("#value-options-condition-and-value-"+e+"-"+c+"-"+a).show()}else{$jq("#value-options-condition-and-value-"+e+"-"+c+"-"+a).hide()}wppfm_storeValueCondition(e,c,a)}function wppfm_decrease_channel_updates_counter(){var a=$jq(".update-count").text();var b=a>1?a-1:"";$jq(".update-count").html(b)}function wppfm_getOutputFieldsList(d){var c="";var b=[];switch(d){case 3:b=_undefinedRecommendedOutputs;break;case 4:b=_undefinedOptionalOutputs;break;default:break}for(var a=0;a<b.length;a++){c+='<option value="'+b[a]+'">'+b[a]+"</option>"}return c}function wppfm_fixedSourcesList(b){var d="";var c="";for(var a=0;a<_inputFields.length;a++){c=b===_inputFields[a].value?" selected":"";d+='<option value = "'+_inputFields[a].value+'" itemprop="'+_inputFields[a].prop+'" '+c+">"+_inputFields[a].label+"</option>"}return d}function wppfm_hideFeedFormMainInputs(){$jq("#category-list-row").hide();$jq("#aggregator-selector-row").hide();$jq("#add-product-variations-row").hide()}function wppfm_editFeedFilter(){alert("The Advanced Filter option is not available in the free version. Unlock the Advanced Filter option by upgrading to the Premium plugin. For more information goto http://www.wpmarketingrobot.com/.")}function wppfm_makeFeedFilterWrapper(a,b){var c="All products from the selected Shop Categories will be included in the feed";c+='<span id="filter-edit-text" style="display:initial;"> (<a class="edit-feed-filter wppfm-btn wppfm-btn-small" href="javascript:void(0)" id="edit-feed-filters-'+a;c+='" onclick="wppfm_editFeedFilter()">edit</a>)</span>';$jq(".product-filter-condition-wrapper").html(c);$jq(".main-product-filter-wrapper").show()}function wppfm_getCombinedSeparatorList(b){var a={"0":"-- No separator --","1":"space","2":"comma","3":"point","4":"semicolon","5":"colon","6":"dash","7":"slash","8":"backslash"};var c="";for(var d in a){if(d!==b){c+='<option value="'+d+'">'+a[d]+"</option>"}else{c+='<option value="'+d+'" selected>'+a[d]+"</option>"}}return c}function updateFeedFormAfterInputChanged(a,b){wppfm_enableFeedActionButtons();wppfm_finishOrUpdateFeedPage(b);if(a===undefined||a<1){wppfm_constructNewFeed()}}$jq(document).ready(function(){var a=wppfm_getUrlVariable("id");_feedHolder=new Feed();if(a!==""){wppfm_editExistingFeed(a)}wppfm_listen()});