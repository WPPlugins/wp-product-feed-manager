/*!
 * object-feed.js v1.4
 * Part of the WP Product Feed Manager
 * Copyright 2017, Michel Jongbloed
 *
 */
"use strict";function Feed(f,m,h,d,j,k,e,c,a,g,b,l,o,n,i){this.feedId=f;this.title=m;this.mainCategory=k;this.categoryMapping=e;this.includeVariations=h;this.isAggregator=d;this.feedTitle=b;this.feedDescription=l;this.url=c;this.dataSource=a;this.channel=j;this.country=j!=="3"?g:"NL";this.status=i;this.updateSchedule=o;this.feedFilter=n;this.attributes=[];this.addAttribute=addAttributeToFeed;this.getAttributeIdByName=getAttributeId;this.activateAttribute=activateFeedsAttribute;this.createCustomAttribute=createCustomFeedsAttribute;this.checkIfCustomNameExists=checkCustomName;this.countCombinedFields=countAttributesCombinedFields;this.deactivateAttribute=deactivateFeedsAttribute;this.deactivateCategory=deactivateCategoryMap;this.activateCategory=activateCategoryMap;this.setStaticAttributeValue=setAttributesStaticValue;this.setSourceValue=setAttributesSourceValue;this.setAlternativeSourceValue=setAlternativeAttributesSourceValue;this.setCombinedOutputValue=setAttributesCombinedOutputValue;this.setCategoryValue=setAttributesCategoryValue;this.setFeedFilter=setFeedFilterValue;this.mapCategory=mapACategory;this.changeCustomFeedCategoryMap=changeCustomCategoryMap;this.changeIncludeVariations=changeIncludeVariationsValue;this.changeAggregator=changeAggregatorValue;this.resetNrQueries=rstNrQueries;this.incrNrQueries=addNrQueries;this.decrNrQueries=substrNrQueries;this.addConditionValue=addAttributesCondition;this.addValueQueryValue=addAttributesValueQuery;this.removeAttribute=removeAttributeFromFeed;this.removeValueConditionValue=removeAttributesCondition;this.removeValueQueryValue=removeAttributesValueQuery;this.removeAlternativeSourceValue=removeAlternativeSource;this.removeCombinedOutputValue=removeAttributesCombinedOutputValue;this.removeEditValueValue=removeAttributesEditValue;this.removeFeedFilter=removeFeedFilterValue;this.getAttributesQueriesObject=getAttributesQueries;this.getCombinedOutputValue=getAttributesCombinedOutputValue;this.getValueQueryValue=getAttributesValueQueries;this.getAttributesSourceObject=getAttributesSources;this.getSourceObject=getSourceData;this.getAlternativeSourcesObject=getAlternativeSources;this.getAttributesValueObject=getAttributesValues;this.getFeedFilter=getFeedFilterValue;this.setMainCategory=setCategories;this.setUpdateSchedule=setSchedule;this.setCustomCategory=setFeedCustomCategory;this.setCountry=changeCountry;this.clearSourceValue=clearAttributesSourceValue;this.cleanAttributes=cleanUnusedAttributes;this.clearAllAttributes=clearAttributes;this.addChangeValue=addAttributesChangeValue}function FeedAttribute(e,g,h,f,b,i,a,c,d){this.rowId=e;this.fieldName=g;this.advisedSource=h;this.value=f;this.fieldLevel=b;this.isActive=i;this.nrQueries=a;this.nrValueEdits=c;this.nrValueConditions=d}function CategoryMap(b,a){this.shopCategoryId=b;this.feedCategories=a}function addAttributeToFeed(e,h,i,g,b,j,d,c,f){var a=new FeedAttribute(e,h,i,g,b,j,d,c,f);this.attributes.push(a)}function removeAttributeFromFeed(b){for(var a=0;a<this.attributes.length;a++){if(this.attributes[a].rowId===b){this.attributes.splice(a,1)}}}function mapACategory(i,a){var h=i.match(/(\d+)$/)[0];var f=i.replace("_"+h,"");var b=f.match(/(\d+)$/)[0];var c=JSON.parse(this.categoryMapping);var d=$jq.grep(c,function(j){return j.shopCategoryId===b});if(d.length>0){var e=d[0].feedCategories;d[0].feedCategories=wppfm_addNewItemToCategoryString(h,e,a," > ")}else{var g=new CategoryMap();g.shopCategoryId=b;g.feedCategories=a;c.push(g)}this.categoryMapping=JSON.stringify(c)}function changeCustomCategoryMap(c,b){var d=JSON.parse(this.categoryMapping);var a=$jq.grep(d,function(f){return f.shopCategoryId===c});if(a.length>0){a[0].feedCategories=b}else{var e=new CategoryMap();e.shopCategoryId=c;e.feedCategories=b;d.push(e)}this.categoryMapping=JSON.stringify(d)}function changeIncludeVariationsValue(a){this.includeVariations=a?"1":"0"}function changeAggregatorValue(a){this.isAggregator=a?"1":"0"}function activateCategoryMap(c,b){var d=this.categoryMapping.length>0?JSON.parse(this.categoryMapping):[];var a=$jq.grep(d,function(f){return f.shopCategoryId===c.toString()});if(a.length<1){var e=new CategoryMap();e.shopCategoryId=c.toString();e.feedCategories=b?"wp_ownCategory":"wp_mainCategory";d.push(e);this.categoryMapping=JSON.stringify(d)}}function deactivateCategoryMap(b){var c=this.categoryMapping.length>0?JSON.parse(this.categoryMapping):[];if(c.length>1){var a=wppfm_arrayObjectIndexOf(c,b.toString(),"shopCategoryId");c.splice(a,1);this.categoryMapping=JSON.stringify(c)}else{this.categoryMapping=[]}}function getAttributeId(a){var c=false;for(var b=0;b<this.attributes.length;b++){if(this.attributes[b]["fieldName"]===a){c=this.attributes[b]["rowId"];break}}if(c===false){c=this.attributes.length}return c}function setAttributesStaticValue(b,e,d,c){var a=this.attributes[b]["value"];this.attributes[b]["value"]=wppfm_storeSourceValue(e,a,"static",c);if(this.attributes[b]["value"]){this.attributes[b]["isActive"]=true}else{this.attributes[b]["isActive"]=false}console.log(this.attributes[b]["value"])}function setAttributesSourceValue(b,c,d){var a=this.attributes[b]["value"];this.attributes[b]["value"]=wppfm_storeSourceValue(c,a,"source",d)}function setAlternativeAttributesSourceValue(b,g,c){var f="";var a={};var d=[];if(this.attributes[b]["value"]){a=JSON.parse(this.attributes[b]["value"]);a.a=addOrRemoveValueInValueString(a.a,c,g,"add")}else{var e={};e[1]=c;d.push(e);a.a=d}f=JSON.stringify(a);this.attributes[b]["value"]=f}function setAttributesCombinedOutputValue(b,c,d){var a=this.attributes[b]["value"];console.log(a);this.attributes[b]["value"]=wppfm_storeCombinedValue(c,a,d)}function getAttributesCombinedOutputValue(a,b){var c=this.attributes[a]["value"]?JSON.parse(this.attributes[a]["value"]):{};if(c&&c.m&&c.m[b]&&c.m[b].s&&c.m[b].s.f){return c.m[b].s.f}else{return""}}function removeAttributesCombinedOutputValue(c,d,b){var a=this.attributes[c]["value"];this.attributes[c]["value"]=wppfm_removeCombinedValue(d,b,a)}function countAttributesCombinedFields(b){if(this.attributes[b]["value"]){var a=JSON.parse(this.attributes[b]["value"]);if(a.hasOwnProperty("f")){return wppfm_countObjectItems(a.f)}else{return 0}}else{return 0}}function setAttributesCategoryValue(b,c){var a=this.attributes[b]["value"];this.attributes[b]["value"]=wppfm_storeSourceValue(0,a,"",c)}function rstNrQueries(a){this.attributes[a]["nrQueries"]=0}function addNrQueries(a){var b=this.attributes[a]["nrQueries"];this.attributes[a]["nrQueries"]=b+1}function substrNrQueries(a){var b=this.attributes[a]["nrQueries"];if(b>0){this.attributes[a]["nrQueries"]=b-1}}function addAttributesChangeValue(b,d,e,c){var a=this.attributes[b]["value"];this.attributes[b]["value"]=wppfm_storeValueChange(d,e,c,"add",a)}function addAttributesCondition(d,c,e,a){var b=this.attributes[d]["value"];this.attributes[d]["value"]=wppfm_storeConditionValue(e,a,b,c)}function addAttributesValueQuery(d,e,c,a){var b=this.attributes[d]["value"];this.attributes[d]["value"]=wppfm_storeQueryValue(e,c,b,a)}function setFeedFilterValue(a){this.feedFilter=a}function removeFeedFilterValue(a){this.feedFilter=removeFeedFilterLevel(this.feedFilter,a)}function removeAttributesCondition(c,d,a){var b=this.attributes[c]["value"];this.attributes[c]["value"]=wppfm_removeConditionValue(d,a,b)}function removeAttributesValueQuery(c,d,b){var a=this.attributes[c]["value"];this.attributes[c]["value"]=wppfm_removeQueryValue(d,b,a)}function removeAttributesEditValue(b,c,d){var a=this.attributes[b]["value"];this.attributes[b]["value"]=wppfm_removeEditValuesValue(c,d,a)}function removeAlternativeSource(b,c){var a={};if(this.attributes[b]["value"]){a=JSON.parse(this.attributes[b]["value"]);a.a=addOrRemoveValueInValueString(a.a,"",c,"remove");if(!a.a){delete a.a}this.attributes[b]["value"]=JSON.stringify(a)}}function getAttributesQueries(b,c){var e=this.attributes[b]["value"];var a={};if(e){var d=JSON.parse(e);if(d&&d.hasOwnProperty("m")&&d.m[c]&&d.m[c].hasOwnProperty("c")&&d.m[c].c.length>0){a=d.m[c].c}}return a}function getAttributesValueQueries(b,c){var e=this.attributes[b]["value"];var a={};if(e){var d=JSON.parse(e);if(d&&d.v&&d.v[c]&&d.v[c].hasOwnProperty("q")&&d.v[c].q.length>0){a=d.v[c].q}}return a}function getAttributesValues(b){var d=this.attributes[b]["value"];var a={};if(d){var c=JSON.parse(d);if(c&&"v" in c&&c.v.length>0){a=c.v}}return a}function getFeedFilterValue(a){}function getAlternativeSources(b){var d=this.attributes[b]["value"];var a={};if(d){var c=JSON.parse(d);if(c&&"a" in c&&c.a.length>0){a=c.a}}return a}function getSourceData(a){var c={};c.rowId=a;c.fieldName=this.attributes[a]["fieldName"];c.advisedSource=this.attributes[a]["advisedSource"];var d=this.attributes[a]["value"];if(d){var b=JSON.parse(d);c.mapping=b&&"m" in b?b.m:[];c.changeValues=b&&"v" in b?b.v:[];c.customCondition=b&&"t" in b?true:false}else{c.mapping=[];c.changeValues=[];c.customCondition=false}return c}function getAttributesSources(a){var d=this.attributes[a]["value"];var b={};if(d){var c=JSON.parse(d);if(c&&"s" in c){b=c.s}}return b}function addOrRemoveQueryInQueryString(a,d,f,c){var b=a?a:[];if(c==="add"){var e={};e[f]=d;if(f in e){b.splice(f-1,1,e)}else{b.push(e)}}else{b.splice(f-1,1);b=wppfm_resortObject(b)}if(wppfm_countObjectItems(b)>0){return b}else{return""}}function addOrRemoveValueInValueString(b,d,g,e){var c=b?b:[];if(e==="add"){var f={};var a="";f[g]=d;if(c[g-1]&&"q" in c[g-1]){a=c[g-1]["q"]}if(g in f){c.splice(g-1,1)}if(a){f.q=a}c.push(f)}else{c.splice(g-1,1);c=wppfm_resortObject(c)}if(wppfm_countObjectItems(c)>0){return c}else{return""}}function clearAttributesSourceValue(a,b){if(this.attributes[a]["value"]){this.attributes[a]["value"]=wppfm_storeSourceValue(b,this.attributes[a]["value"],"clear","")}else{this.attributes[a]["value"]=""}}function setFeedCustomCategory(b,a){console.log(this.attributes);console.log(a);this.mainCategory=a;var d=b?b:getCustomCategoryAttributeId(this.attributes,a);if(d){console.log(d);var c=this.attributes[d]["value"]?JSON.parse(this.attributes[d]["value"]):{};c.t=a;this.attributes[d]["value"]=JSON.stringify(c)}}function changeCountry(a){this.country=a}function getCustomCategoryAttributeId(a){for(var b=0;b<a.length;b++){console.log(a[b]);var c=a[b]["value"]?JSON.parse(a[b]["value"]):{};console.log(c);if(c.hasOwnProperty("t")){return b}}}function setCategories(a,b,e){if(this.attributes[3]!==undefined){var h="";var c=0;var f=this.attributes[3]["value"]?JSON.parse(this.attributes[3]["value"]):{};var k=e!=="14"?" > ":" | ";h=this.mainCategory;c=this.attributes[3]["value"]!==undefined?h.split(k).length:0;var j=a.match(/(\d+)$/)[0];if(j==="0"){this.mainCategory=b;this.attributes[3]["value"]='{"t":"'+b+'"}'}else{if(c<=j){this.mainCategory+=k+b;this.attributes[3]["value"]='{"t":"'+f.t+k+b+'"}'}else{var g=0;for(var d=0;d<j;d++){g=h.indexOf(k,g+1)}h=h.substring(0,g);this.mainCategory=h+k+b;this.attributes[3]["value"]='{"t":"'+h+k+b+'"}'}}}}function setSchedule(d,a,b,c){this.updateSchedule=d+":"+a+":"+b+":"+c}function activateFeedsAttribute(a){this.attributes[a]["isActive"]=true}function deactivateFeedsAttribute(a){if(this.attributes[a]["fieldLevel"]!=="1"){var b=this.attributes[a]["value"]?JSON.parse(this.attributes[a]["value"]):{};this.attributes[a]["isActive"]=false;if(b&&!"t" in b){this.attributes[a]["value"]=""}}else{this.attributes[a]["isActive"]=true}}function createCustomFeedsAttribute(a){this.attributes[a]=new FeedAttribute()}function checkCustomName(b){var a=false;for(var c=0;c<this.attributes.length;c++){if(this.attributes[c]["fieldName"]===b){a=true}}return a}function removeAttribute(a){this.attributes.splice(a,1)}function cleanUnusedAttributes(){if(this.attributes.length>0){for(var a=0;a<this.attributes.length;a++){if(this.attributes[a]["isActive"]!==true){this.attributes.splice(a,1);a--}else{if(this.attributes[a]["advisedSource"]===undefined&&getSourceString(this.attributes[a]["value"])===""){this.attributes.splice(a,1);a--}}}}}function clearAttributes(){this.attributes=[]};